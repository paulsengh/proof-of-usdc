interface EmailHeaders {
  deliveredTo: string;
  received: string;
  date: string;
  from: string;
  to: string;
  subject: string;
  messageId: string;
  dkimSignature: string;
  htmlBody: string;
}

export function parseEmailContent(content: string): EmailHeaders {
  const emailHeaders: EmailHeaders = {
    deliveredTo: "",
    received: "",
    date: "",
    from: "",
    to: "",
    subject: "",
    messageId: "",
    dkimSignature: "",
    htmlBody: "",
  };

  // Regular expressions to capture specific fields
  const headerRegexMap: { [key: string]: RegExp } = {
    deliveredTo: /Delivered-To:\s(.+)/,
    received: /Received:\sby\s(.+)/,
    date: /Date:\s(.+)/,
    from: /From:\s(.+)/,
    to: /To:\s(.+)/,
    subject: /Subject:\s(.+)/,
    messageId: /Message-ID:\s(.+)/,
    dkimSignature: /DKIM-Signature:\sv=1;\s(.+)/,
  };

  // Extract headers
  for (const [key, regex] of Object.entries(headerRegexMap)) {
    const match = content.match(regex);
    if (match && match[1]) {
      emailHeaders[key as keyof EmailHeaders] = match[1].trim();
    }
  }

  // Extract HTML body (assuming it's after a specific marker)
  const htmlBodyMatch = content.match(/<body.*?>([\s\S]*?)<\/body>/i);
  if (htmlBodyMatch && htmlBodyMatch[1]) {
    emailHeaders.htmlBody = htmlBodyMatch[1].trim();
  }

  return emailHeaders;
}

// Example usage:
const decodedContent = `Delivered-To: oliver.qin1@gmail.com Received: by 2002:a05:6a10:87c9:b0:527:78e0:83e5 with SMTP id g9csp2201314pxr; Sun, 24 Dec 2023 19:16:08 -0800 (PST) X-Google-Smtp-Source: AGHT+IGCyIM3s1SqlOBOrDF5TBi4UVhWbAN3ym477Ryu9UnVVqW5ElT6rSP+bNLSyEHThFXbtSHP X-Received: by 2002:a05:6214:19e2:b0:67f:bde:ef9f with SMTP id q2-20020a05621419e200b0067f0bdeef9fmr9718722qvc.36.1703474168509; Sun, 24 Dec 2023 19:16:08 -0800 (PST) ARC-Seal: i=1; a=rsa-sha256; t=1703474168; cv=none; d=google.com; s=arc-20160816; b=jeIXvXTW4QWdUif4HyMAjcVW5tG8QzkbeTPzDmdZJeLQojwh6Ag57fcHRTHnBr60Lm v1m/nZInSpnMKCZfyKcQGu08lK9v/aFM2gN7K8vs3CFDOgkDnOtPSjlJl4PrMnC9YDNE d9QHmK/yDgNClWR7jFkyvtyfzszI3aSjQmtaGhwfoyVbhlMBssg9jtdiqILQBdFq8JRk OK2+vptjzvNGGVnWa8xdXTnSUaBJhn7tVPY5Nv/9iBObcpexbPKObyL8v5n96QyHMgVl 5khp2L43JbE3vmUXKGESDR0vUDyuU+HRQu9nqIjrFbt/EmIWWedtz/1VS0xDo8Wu2jkC zmTw== ARC-Message-Signature: i=1; a=rsa-sha256; c=relaxed/relaxed; d=google.com; s=arc-20160816; h=feedback-id:list-unsubscribe:content-transfer-encoding:mime-version :subject:message-id:to:from:date:dkim-signature:dkim-signature; bh=qb/nPJEt97xHD6VMAe9sjL+KMV6XiT/8t7IQWJ2Ex4I=; fh=pBMDGNSqc/EoKBmCV3dNZ7n8nbSqvVcHKrmhMD5+W/o=; b=cNAMB3jjK3RoKfDgyzoA9NNTQJgH/XX1MMzguxXzykX6LKOY4VcERxKm5rlbu+qVXq t3WPzWQj2dkUYvQlx6OAsSnbrru6aYg9TS0VO6/lEhEQpGlIqQRujojwSZKaZ0C22RMR xb61FINq+RBNDWpmesPo0EyNBPfiWAVHnq9wl6SygHJUBqCZXWddiRa31WByBq4+t6St WVF5WRcKuC6Qo6BWeju4aTgvXdrXTN7jckBik3wsm8Y1xdnn9znxFs/+PsZTc161sOKm aclNWmVCpyguiumZDQN+C6wYoYWjS8/AjxTj083EPJi1bWkLkDvr85ZDDne8bBumK7Ev 7GJg== ARC-Authentication-Results: i=1; mx.google.com; dkim=pass header.i=@coinbase.com header.s=7czdtvwxhuu3gaqucql53xrmpf777voz header.b="fBL5X44/"; dkim=pass header.i=@amazonses.com header.s=224i4yxa5dv7c2xz3womw6peuasteono header.b=C0lfS37e; spf=pass (google.com: domain of 0100018c9ef90077-eac53d29-d6fe-46af-9712-35bcb770d19f-000000@amazonses.com designates 54.240.36.141 as permitted sender) smtp.mailfrom=0100018c9ef90077-eac53d29-d6fe-46af-9712-35bcb770d19f-000000@amazonses.com; dmarc=pass (p=REJECT sp=REJECT dis=NONE) header.from=coinbase.com Return-Path: <0100018c9ef90077-eac53d29-d6fe-46af-9712-35bcb770d19f-000000@amazonses.com> Received: from a36-141.smtp-out.amazonses.com (a36-141.smtp-out.amazonses.com. [54.240.36.141]) by mx.google.com with ESMTPS id j12-20020a0cf50c000000b0067f69d71261si10047416qvm.13.2023.12.24.19.16.08 for <oliver.qin1@gmail.com> (version=TLS1_2 cipher=ECDHE-ECDSA-AES128-GCM-SHA256 bits=128/128); Sun, 24 Dec 2023 19:16:08 -0800 (PST) Received-SPF: pass (google.com: domain of 0100018c9ef90077-eac53d29-d6fe-46af-9712-35bcb770d19f-000000@amazonses.com designates 54.240.36.141 as permitted sender) client-ip=54.240.36.141; Authentication-Results: mx.google.com; dkim=pass header.i=@coinbase.com header.s=7czdtvwxhuu3gaqucql53xrmpf777voz header.b="fBL5X44/"; dkim=pass header.i=@amazonses.com header.s=224i4yxa5dv7c2xz3womw6peuasteono header.b=C0lfS37e; spf=pass (google.com: domain of 0100018c9ef90077-eac53d29-d6fe-46af-9712-35bcb770d19f-000000@amazonses.com designates 54.240.36.141 as permitted sender) smtp.mailfrom=0100018c9ef90077-eac53d29-d6fe-46af-9712-35bcb770d19f-000000@amazonses.com; dmarc=pass (p=REJECT sp=REJECT dis=NONE) header.from=coinbase.com DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/simple; s=7czdtvwxhuu3gaqucql53xrmpf777voz; d=coinbase.com; t=1703474168; h=Date:From:To:Message-ID:Subject:Mime-Version:Content-Type:Content-Transfer-Encoding:List-Unsubscribe; bh=wHLY7QJjhMlt6uVNVLqhqvGP/aZ+saPc+tGcLQM1qLQ=; b=fBL5X44/06HwUrWwPgt6EcYJ2wdCaTjEhKFYY6uOwkbomnis2RRx6G31vnTiGmOA CjGhZrxVWhzuw0WJ1G0hRtqUDVOOgTX3/1ifFOC+fRd3OvF6455lGPZ+q70rfMnObyV r8ovAuJiC/TBXAwJe88hdnHidA+C/ndKiI94HVQE= DKIM-Signature: v=1; a=rsa-sha256; q=dns/txt; c=relaxed/simple; s=224i4yxa5dv7c2xz3womw6peuasteono; d=amazonses.com; t=1703474168; h=Date:From:To:Message-ID:Subject:Mime-Version:Content-Type:Content-Transfer-Encoding:List-Unsubscribe:Feedback-ID; bh=wHLY7QJjhMlt6uVNVLqhqvGP/aZ+saPc+tGcLQM1qLQ=; b=C0lfS37ewmlWKsHZ5Ntoi4UM2BDHGmCLRa7mxelYr57YGlIizd0pUCSd1XHDvyKu wL75Km4CyMHI5g8lCksrmPZY9KXAbTTdVrcWbyq3nWqwCfEUefJ1SxLa2hq3rbI50ZR bXP2tDBvtSJFNK9zKoGUUqKblDLoq8FRdye0jums= Date: Mon, 25 Dec 2023 03:16:07 +0000 From: Coinbase <no-reply@coinbase.com> To: oliver.qin1@gmail.com Message-ID: <0100018c9ef90077-eac53d29-d6fe-46af-9712-35bcb770d19f-000000@email.amazonses.com> Subject: You just received 99.99965314 SOL Mime-Version: 1.0 Content-Type: text/html; charset=UTF-8 Content-Transfer-Encoding: 7bit List-Unsubscribe: https://www.coinbase.com/unsubscribe?data=BAh7BzoMdXNlcl9pZFU6E0JTT046Ok9iamVjdElkIhFc3Zac8J%2FwAQCvvgs6FXVuc3Vic2NyaWJlX3R5cGU6EnNlbmRfY3VycmVuY3k%3D--d62b835c64242c1d8e1fc6b180649b88e2b315cc Feedback-ID: 1.us-east-1.TQLiVf/rBjClwRiRLqnvdJT2gxVOHcgDf6Da6aS84zo=:AmazonSES X-SES-Outgoing: 2023.12.25-54.240.36.141 <!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"> <html> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <title>Coinbase</title> </head> <body style="!important background-color: #F2F5F7; height: 100% !important; margin: 0; padding: 0; width: 100% !important;" bgcolor="#F2F5F7"> <!-- HIDDEN PREHEADER TEXT --> <div style="color: #fefefe; display: none; font-family: Open Sans, Helvetica, Arial, sans-serif; font-size: 1px; line-height: 1px; max-height: 0px; max-width: 0px; opacity: 0; overflow: hidden;"> Coinbase makes cryptocurrency easy! </div> <table id="main" width="100%" height="100%" cellpadding="0" cellspacing="0" border="0"> <tbody> <tr> <td valign="top" align="center" bgcolor="#0052FF" style="background: #0052FF; padding: 0 15px;"> <table class="innermain" cellpadding="0" width="100%" cellspacing="0" border="0" align="center" style="margin:0 auto; table-layout: fixed; border-collapse: collapse !important; max-width: 600px;"> <tbody> <!-- START of MAIL Content --> <tr> <td align="center" valign="top" width="100%"> <!-- Logo start here --> <table class="logo" width="100%" cellpadding="0" cellspacing="0" border="0"> <tbody> <tr><td align="center" valign="top" style="-ms-text-size-adjust: 100%; -webkit-text-size-adjust: 100%; mso-table-lspace: 0pt; mso-table-rspace: 0pt; padding: 30px 0;"> <img alt="Coinbase" width="150" src="https://static-assets.coinbase.com/email/coinbase-transactional-wordmark-white.png" /> </td></tr> </tbody> </table> <!-- Logo end here --> <!-- Main CONTENT --> <table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff" style="border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.05);"> <tbody> <tr> <td height="40"></td> </tr> <tr style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color:#4E5C6E; font-size:14px; line-height:20px; margin-top:20px;"> <td class="content" colspan="2" valign="top" align="center" style="padding-left:40px; padding-right:40px;"> <table width="100%" cellpadding="0" cellspacing="0" border="0" bgcolor="#ffffff"> <tbody> <tr> <td align="center" valign="bottom" colspan="2" cellpadding="3"> <img alt="" width="80" src="https://www.coinbase.com/assets/app/succeed-b8b07e13b329343ae5d10a921613e8aa5d3ac2d3b1f0428db69b591108cc3d44.png" /> </td> </tr> <tr><td height="20" &nbsp;=""></td></tr> <tr> <td align="center"> <span style="color:#48545d;font-size:22px;line-height: 24px; display:block; margin-bottom: 3px;"> You just received </span> <span style="color:#8C8E8E; font-size:15px;line-height: 24px;"> 99.99965314 SOL ($11,165.46 USD) </span> <br> <span style="color:#8C8E8E; font-size:15px;line-height: 24px;"> via Solana network </span> </td> </tr> <tr><td height="24" &nbsp;=""></td></tr> <tr> <td height="1" bgcolor="#DAE1E9"></td> </tr> <tr><td height="24" &nbsp;=""></td></tr> <tr> <td align="center"> <span style="color:#48545d;font-size:14px;line-height:24px;"> You just received 99.99965314 SOL ($11,165.46 USD) from an external Solana account. It may take up to 31 network confirmations before your Solana is available to trade. <a href="https://help.coinbase.com/en/coinbase/trading-and-funding/sending-or-receiving-cryptocurrency/why-is-my-transaction-pending">Learn more</a> </span> </td> </tr> <tr><td height="30" &nbsp;=""></td></tr> <tr> <td valign="top" width="48%" align="center"> <a href="https://www.coinbase.com/accounts/91eed2a2-c120-5b8f-912f-6f2869a5b689/transactions/8ca4ce69-1136-5f31-b39e-b08409d3ad29" style="display:block; padding:15px 25px; background-color:#0082CA; color:#ffffff; border-radius:3px; text-decoration:none;">Sign in to view transaction</a> </td> </tr> </tbody> </table> </td> </tr> <tr> <td height="40"></td> </tr> </tbody> </table> <!-- Main CONTENT end here --> <!-- PROMO column start here --> <!-- Show mobile promo 75% of the time --> <table id="promo" width="100%" cellpadding="0" cellspacing="0" border="0" style="margin-top:20px;" > <tbody> <tr> <td colspan="2" height="20"></td> </tr> <tr> <td colspan="2" align="center"> <span style="font-size:14px; font-weight:400; margin-bottom:10px; color: #FEFEFE; font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif;">Get the latest Coinbase App for your phone</span> </td> </tr> <tr> <td colspan="2" height="20"></td> </tr> <tr> <td valign="top" width="50%" align="right"> <a href="https://itunes.apple.com/us/app/coinbase-bitcoin-wallet/id886427730?mt=8" style="display:inline-block;margin-right:10px;"> <img src="https://s3.amazonaws.com/app-public/Coinbase-email/iOS_app.png" height="40" border="0" alt="Coinbase iOS mobile bitcoin wallet"> </a> </td> <td valign="top"> <a href="https://play.google.com/store/apps/details?id=com.coinbase.android" style="display:inline-block;margin-left:5px;"> <img src="https://s3.amazonaws.com/app-public/Coinbase-email/Android_app.png" height="40" border="0" alt="Coinbase Android mobile bitcoin wallet" style="height:40px !important"> </a> </td> </tr> </tbody> </table> <!-- PROMO column end here --> <!-- FOOTER start here --> <table width="100%" cellpadding="0" cellspacing="0" border="0"> <tbody> <tr> <td height="10">&nbsp;</td> </tr> <tr> <td valign="top" align="center"> <span style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #fefefe; font-size:10px; margin-bottom:5px; display:block;"> To stop receiving these emails, <a href="https://www.coinbase.com/unsubscribe?data=BAh7BzoMdXNlcl9pZFU6E0JTT046Ok9iamVjdElkIhFc3Zac8J%2FwAQCvvgs6FXVuc3Vic2NyaWJlX3R5cGU6EnNlbmRfY3VycmVuY3k%3D--d62b835c64242c1d8e1fc6b180649b88e2b315cc" target="_blank" style="color: #fefefe !important;">unsubscribe from this list</a>. </span> </td> </tr> <tr> <td height="10"></td> </tr> <tr> <td valign="top" align="center"> <span style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #fefefe; font-size:10px; margin-bottom:5px; display:block;"> <a href="https://www.coinbase.com/legal/user_agreement?country=US" target="_blank" tabindex="-1" style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #FEFEFE; font-size:10px; margin-bottom:5px;text-decoration:underline;">Terms of Service</a> </span> </td> </tr> <tr> <td valign="top" align="center"> <span style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #FEFEFE; font-size: 10px;">&copy; <a href="https://www.coinbase.com/" target="_blank" style="color: #FEFEFE !important; text-decoration:none;">Coinbase</a> 2023 </span> <br/> <span style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #fefefe; font-size:10px;"> Coinbase, Inc. </span> <br/> <span style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #fefefe; font-size:10px;"> 248 3rd Street, #434 | Oakland, CA 94067 | United States </span> <br/> <span style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #fefefe; font-size:10px;"> 1-888-908-7930 </span> <br/> <span style="font-family: -apple-system,BlinkMacSystemFont,&#39;Segoe UI&#39;,&#39;Roboto&#39;,&#39;Oxygen&#39;,&#39;Ubuntu&#39;,&#39;Cantarell&#39;,&#39;Fira Sans&#39;,&#39;Droid Sans&#39;,&#39;Helvetica Neue&#39;,sans-serif; color: #fefefe; font-size:10px;"> NMLS ID: 1163082 </span> </td> </tr> <tr> <td height="50">&nbsp;</td> </tr> </tbody> </table> <!-- FOOTER end here --> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </body> </html>`; // your email content here
const parsedEmail = parseEmailContent(decodedContent);

console.log(parsedEmail);
